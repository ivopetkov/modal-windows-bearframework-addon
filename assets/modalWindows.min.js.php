<?php

/*
 * Modal windows addon for Bear Framework
 * https://github.com/ivopetkov/modal-windows-bearframework-addon
 * Copyright (c) Ivo Petkov
 * Free to use under the MIT license.
 */

return <<<'EOT'
var ivoPetkov=ivoPetkov||{};ivoPetkov.bearFrameworkAddons=ivoPetkov.bearFrameworkAddons||{},ivoPetkov.bearFrameworkAddons.modalWindows=ivoPetkov.bearFrameworkAddons.modalWindows||function(){var n=!1,t={},e=null;Promise=window.Promise||function(n){var t=[],e=null;this.then=function(n){return t.push(n),this},this.catch=function(n){return null===e&&(e=n),this};var o=function(){for(var n in t)t[n].apply(null,arguments)},i=function(){null!==e&&e.apply(null,arguments)};window.setTimeout((function(){n(o,i)}),16)};var o=null,i=null,l=0,d=function(){if(null!==e&&e.lastChild){var n=e.lastChild;if(1===i)return c++,u().then((function(){n.setAttribute("class","ipmdlwndwv")})),!1;if(null!==n.getAttribute("data-mw-disabled"))return!1;if(n.mwClose())return!1}else null!==i&&v()},r=function(){return l++,new Promise((function(n,t){1!==i?(i=1,clientPackages.get("lightbox").then((function(t){o=t.make({showCloseButton:!1,onBeforeEscKeyClose:d}),n()}))):n()}))},u=function(){return--l<0&&(l=0),l>0?new Promise((function(n,t){n()})):1===i?(i=2,o.open("",{showCloseButton:!1,spacing:0,onBeforeEscKeyClose:d})):new Promise((function(n,t){n()}))},a=function(){null!==o&&(l=0,i=null,o.close(),o=null)},c=0,s=function(){var o=null,l=function(){if(c++,null!==o){var n=o.previousSibling;return o.setAttribute("class","ipmdlwndwh"),window.setTimeout((function(){e.removeChild(o),0===e.childNodes.length&&(e.parentNode.removeChild(e),e=null),null!==n&&n.setAttribute("class","ipmdlwndwv")}),300),0===e.childNodes.length-1&&a(),!0}return!1},d=function(){null!==o&&o.removeAttribute("data-mw-disabled")},s=function(){null!==o&&o.setAttribute("data-mw-disabled","1")};return{open:function(a,v,w){void 0===v&&(v={}),void 0===w&&(w={});var h=++c,f=void 0!==w.onOpen?w.onOpen:null;if(null!==e)for(var p=e.childNodes,b=0;b<p.length;b++)p[b].setAttribute("class","ipmdlwndwvh");var g=function(){if(m(),null!==e){var n=e.lastChild;null!==n&&n.setAttribute("class","ipmdlwndwv")}},C=a+"$"+JSON.stringify(v),A=function(n,i){null===e&&((e=document.createElement("div")).setAttribute("class","ipmdlwndwsc"),document.body.appendChild(e)),(o=document.createElement("div")).setAttribute("data-form-tooltip-container","true"),e.appendChild(o);html5DOMDocument.insert('<div><div data-modal-window-component="window"><div data-modal-window-component="header"><div data-modal-window-component="header-title"></div><div data-modal-window-component="header-buttons"><div data-modal-window-component="header-button-close"></div></div></div><div data-modal-window-component="content"></div></div></div>',[o]);var r=o.firstChild.firstChild,u=r.querySelector('[data-modal-window-component="header-title"]'),a=r.querySelector('[data-modal-window-component="header-button-close"]'),c=r.querySelector('[data-modal-window-component="content"]');a.addEventListener("click",l),a.addEventListener("keydown",(function(n){13===n.keyCode&&l()})),a.setAttribute("tabindex","0"),void 0!==n.width&&(r.style.width=n.width),void 0!==n.title&&(u.innerText=n.title),void 0!==n.content&&html5DOMDocument.insert(n.content,[c]);for(var v=r.querySelectorAll("form"),m=0;m<v.length;m++){var w=v[m];w.addEventListener("submitstart",s),w.addEventListener("submitend",d)}window.setTimeout((function(){o.setAttribute("class","ipmdlwndwv")}),16),null!==f&&f(o),o.mwClose=l,i&&void 0!==n.cacheTTL&&(t[C]=[n,(new Date).getTime()+1e3*n.cacheTTL])};r().then((function(){void 0!==t[C]&&t[C][1]>(new Date).getTime()?u().then((function(){c===h&&2===i&&A(t[C][0],!1)})):clientPackages.get("serverRequests").then((function(t){clientPackages.get("html5DOMDocument").then((function(e){t.send("-modal-window-open",{i:a,d:JSON.stringify(v),g:n?0:1}).then((function(t){u().then((function(){if(c===h&&2===i){var o=JSON.parse(t);void 0!==o.s&&(e.insert(o.s),n=!0),void 0!==o.c?A(o.c,!0):g()}}))})).catch(g)})).catch(g)})).catch(g)}))},close:l,enable:d,disable:s}},v=function(){return new Promise((function(n,t){if(null!==e&&e.childNodes.length>0){for(var o=e.childNodes,i=o.length-2;i>=0;i--)e.removeChild(o[i]);var l=e.firstChild;null!==l&&l.mwClose(),n()}else c++,m().then(n).catch(t)}))},m=function(){return new Promise((function(n,t){u().then((function(){null!==e&&0!==e.childNodes.length||a(),n()})).catch(t)}))};return{open:function(n,t,e){void 0===e&&(e={});var o=s();return o.open(n,t,e),o},closeAll:v,closeCurrent:function(){if(null!==e){var n=e.lastChild;null!==n&&n.mwClose()}},showLoading:function(){return new Promise((function(n,t){r().then(n).catch(t)}))},hideLoading:m,hasOpened:function(){return null!==o}}}();
EOT;
