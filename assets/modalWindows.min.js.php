<?php

/*
 * Modal windows addon for Bear Framework
 * https://github.com/ivopetkov/modal-windows-bearframework-addon
 * Copyright (c) Ivo Petkov
 * Free to use under the MIT license.
 */

return <<<'EOT'
var ivoPetkov=ivoPetkov||{};ivoPetkov.bearFrameworkAddons=ivoPetkov.bearFrameworkAddons||{},ivoPetkov.bearFrameworkAddons.modalWindows=ivoPetkov.bearFrameworkAddons.modalWindows||function(){Promise=window.Promise||function(n){var t=[],e=null;this.then=function(n){return t.push(n),this},this.catch=function(n){return null===e&&(e=n),this};var i=function(){for(var n in t)t[n].apply(null,arguments)},o=function(){null!==e&&e.apply(null,arguments)};window.setTimeout((function(){n(i,o)}),16)};var n=null,t=null,e=0,i=function(){return 0!==--e?new Promise((function(n,t){n()})):1===t?(t=2,n.open("",{showCloseButton:!1,spacing:0})):new Promise((function(n,t){n()}))},o=function(){null!==n&&(t=null,n.close(),n=null)},l=!1,d=null,s=function(){var n=null,t=function(){if(null!==n){var t=n.previousSibling;n.setAttribute("class","ipmdlwndwh"),window.setTimeout((function(){d.removeChild(n),0===d.childNodes.length&&(d.parentNode.removeChild(d),d=null),null!==t&&t.setAttribute("class","ipmdlwndwv")}),300),1===d.childNodes.length&&o()}},e=function(){null!==n&&n.removeAttribute("data-mw-disabled")},s=function(){null!==n&&n.setAttribute("data-mw-disabled","1")};return{open:function(o,c){if(void 0===c&&(c={}),null!==d)for(var a=d.childNodes,v=0;v<a.length;v++)a[v].setAttribute("class","ipmdlwndwvh");var h=function(){if(u(),null!==d){var n=d.lastChild;null!==n&&n.setAttribute("class","ipmdlwndwv")}};r(),clientPackages.get("serverRequests").then((function(r){clientPackages.get("-ivopetkov-js-modal-windows-html5domdocument").then((function(u){r.send("-modal-window-open",{i:o,d:JSON.stringify(c),g:l?0:1}).then((function(o){var r=JSON.parse(o);void 0!==r.s&&(u.insert(r.s),l=!0),void 0!==r.c?i().then((function(){null===d&&((d=document.createElement("div")).setAttribute("class","ipmdlwndwsc"),document.body.appendChild(d)),n=document.createElement("div"),d.appendChild(n),u.insert("<div><div><div></div><div></div><div></div></div></div>",[n]);var i=n.firstChild.firstChild;i.firstChild.addEventListener("click",t),void 0!==r.c.width&&(i.style.width=r.c.width),void 0!==r.c.title&&(i.childNodes[1].innerText=r.c.title),void 0!==r.c.content&&u.insert(r.c.content,[i.lastChild]);for(var o=i.querySelectorAll("form"),l=0;l<o.length;l++){var c=o[l];c.addEventListener("submitstart",s),c.addEventListener("submitend",e)}window.setTimeout((function(){n.setAttribute("class","ipmdlwndwv")}),16),n.mwClose=t})):h()})).catch(h)})).catch(h)})).catch(h)},close:t,enable:e,disable:s}},r=function(){e++,1!==t&&(t=1,clientPackages.get("lightbox").then((function(t){n=t.make({showCloseButton:!1})})))},u=function(){i(),null!==d&&0!==d.childNodes.length||o()};return{open:function(n,t){var e=s();return e.open(n,t),e},closeAll:function(){if(null!==d){for(var n=d.childNodes,t=n.length-2;t>=0;t--)d.removeChild(n[t]);var e=d.firstChild;null!==e&&e.mwClose()}},showLoading:r,hideLoading:u}}();
EOT;
