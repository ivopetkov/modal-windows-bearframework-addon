<?php

/*
 * Modal windows addon for Bear Framework
 * https://github.com/ivopetkov/modal-windows-bearframework-addon
 * Copyright (c) Ivo Petkov
 * Free to use under the MIT license.
 */

return <<<'EOT'
var ivoPetkov=ivoPetkov||{};ivoPetkov.bearFrameworkAddons=ivoPetkov.bearFrameworkAddons||{},ivoPetkov.bearFrameworkAddons.modalWindows=ivoPetkov.bearFrameworkAddons.modalWindows||function(){var e=!1,n={},t=null,o="";Promise=window.Promise||function(e){var n=[],t=null;this.then=function(e){return n.push(e),this},this.catch=function(e){return null===t&&(t=e),this};var o=function(){for(var e in n)n[e].apply(null,arguments)},i=function(){null!==t&&t.apply(null,arguments)};window.setTimeout((function(){e(o,i)}),16)};var i=null,l=null,d=0,r=function(e,n){n?(e.setAttribute("class","ipmdlwndwv"),e.removeAttribute("inert")):(e.setAttribute("class","ipmdlwndwvh"),e.setAttribute("inert","true"))},u=function(){if(null!==t&&t.lastChild){var e=t.lastChild;if(1===l)return v++,a(e.mwCloseOnEscKey).then((function(){r(e,!0)})),!1;if(null!==e.getAttribute("data-mw-disabled"))return!1;if(e.mwClose())return!1}else null!==l&&m()},c=function(e){return d++,new Promise((function(n,t){1!==l?(l=1,clientPackages.get("lightbox").then((function(t){i=t.make({showCloseButton:!1,spacing:0,closeOnEscKey:e,onBeforeEscKeyClose:u}),n()}))):n()}))},a=function(e){return--d<0&&(d=0),d>0?new Promise((function(e,n){e()})):1===l?(l=2,i.open("",{showCloseButton:!1,spacing:0,closeOnEscKey:e,onBeforeEscKeyClose:u,resolveBeforeHTMLAdded:!0})):new Promise((function(e,n){e()}))},s=function(){null!==i&&(d=0,l=null,i.close(),i=null)},v=0,h=function(){var i=null,d=function(){if(v++,null!==i){var e=i.previousSibling;return i.setAttribute("class","ipmdlwndwh"),window.setTimeout((function(){t.removeChild(i),0===t.childNodes.length&&(t.parentNode.removeChild(t),t=null),null!==e&&r(e,!0)}),300),0===t.childNodes.length-1&&s(),!0}return!1},u=function(){null!==i&&(i.removeAttribute("data-mw-disabled"),i.removeAttribute("inert"))},h=function(){null!==i&&(i.setAttribute("data-mw-disabled","1"),i.setAttribute("inert","true"))};return{open:function(s,m,f){void 0===m&&(m={}),void 0===f&&(f={});var p=++v,b=void 0!==f.onOpen?f.onOpen:null,C=void 0===f.closeOnEscKey||f.closeOnEscKey;if(null!==t)for(var g=t.childNodes,y=0;y<g.length;y++)r(g[y],!1);var A=function(){if(w(),null!==t){var e=t.lastChild;null!==e&&r(e,!0)}},O=s+"$"+JSON.stringify(m),k=function(e,l){null===t&&((t=document.createElement("div")).setAttribute("class","ipmdlwndwsc"),document.body.appendChild(t)),(i=document.createElement("div")).setAttribute("data-form-tooltip-container","true"),t.appendChild(i);var c="";c+='<div data-modal-window-component="header">',c+='<div data-modal-window-component="header-title"></div>',c+='<div data-modal-window-component="header-buttons">',void 0!==e.headerButtons&&(c+=e.headerButtons.join("")),c+='<div data-modal-window-component="header-button-close" tabindex="0" role="button" title="'+o+'"></div>',c+="</div>",c+="</div>",c+='<div data-modal-window-component="content"></div>',html5DOMDocument.insert('<div><div data-modal-window-component="window">'+c+"</div></div>",[i]);var a=i.firstChild.firstChild,s=a.querySelector('[data-modal-window-component="header-title"]'),v=a.querySelector('[data-modal-window-component="header-button-close"]'),m=a.querySelector('[data-modal-window-component="content"]');v.addEventListener("click",d),v.addEventListener("keydown",(function(e){13===e.keyCode&&d()})),void 0!==e.width&&(a.style.width=e.width),void 0!==e.title&&(s.innerText=e.title),void 0!==e.content&&html5DOMDocument.insert(e.content,[m]);for(var w=a.querySelectorAll("form"),f=0;f<w.length;f++){var p=w[f];p.addEventListener("submitstart",h),p.addEventListener("submitend",u)}window.setTimeout((function(){r(i,!0)}),16),null!==b&&b(i),i.mwClose=d,i.mwCloseOnEscKey=C,l&&void 0!==e.cacheTTL&&(n[O]=[e,(new Date).getTime()+1e3*e.cacheTTL])};c(C).then((function(){void 0!==n[O]&&n[O][1]>(new Date).getTime()?a(C).then((function(){v===p&&2===l&&k(n[O][0],!1)})):clientPackages.get("serverRequests").then((function(n){clientPackages.get("html5DOMDocument").then((function(t){n.send("-modal-window-open",{i:s,d:JSON.stringify(m),g:e?0:1}).then((function(n){a(C).then((function(){if(v===p&&2===l){var o=JSON.parse(n);void 0!==o.s&&(t.insert(o.s),e=!0),void 0!==o.c?k(o.c,!0):A()}}))})).catch(A)})).catch(A)})).catch(A)}))},close:d,enable:u,disable:h}},m=function(){return new Promise((function(e,n){if(null!==t&&t.childNodes.length>0){for(var o=t.childNodes,i=o.length-2;i>=0;i--)t.removeChild(o[i]);var l=t.firstChild;null!==l&&l.mwClose(),e()}else v++,w().then(e).catch(n)}))},w=function(){return new Promise((function(e,n){var o=!0;null!==t&&t.lastChild&&(o=t.lastChild.mwCloseOnEscKey);a(o).then((function(){null!==t&&0!==t.childNodes.length||s(),e()})).catch(n)}))};return{initialize:function(e){return o=e[0],this},open:function(e,n,t){void 0===t&&(t={});var o=h();return o.open(e,n,t),o},closeAll:m,closeCurrent:function(){if(null!==t){var e=t.lastChild;null!==e&&e.mwClose()}},showLoading:function(e){void 0===e&&(e={});var n=void 0===e.closeOnEscKey||e.closeOnEscKey;return new Promise((function(e,t){c(n).then(e).catch(t)}))},hideLoading:w,hasOpened:function(){return null!==i}}}();
EOT;
