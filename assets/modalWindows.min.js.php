<?php

/*
 * Modal windows addon for Bear Framework
 * https://github.com/ivopetkov/modal-windows-bearframework-addon
 * Copyright (c) Ivo Petkov
 * Free to use under the MIT license.
 */

return <<<'EOT'
var ivoPetkov=ivoPetkov||{};ivoPetkov.bearFrameworkAddons=ivoPetkov.bearFrameworkAddons||{},ivoPetkov.bearFrameworkAddons.modalWindows=ivoPetkov.bearFrameworkAddons.modalWindows||function(){var n=!1,t={},e=null;Promise=window.Promise||function(n){var t=[],e=null;this.then=function(n){return t.push(n),this},this.catch=function(n){return null===e&&(e=n),this};var i=function(){for(var n in t)t[n].apply(null,arguments)},o=function(){null!==e&&e.apply(null,arguments)};window.setTimeout((function(){n(i,o)}),16)};var i=null,o=null,l=0,d=function(){return setTimeout((function(){if(null!==e&&e.lastChild){var n=e.lastChild;if(null!==n.getAttribute("data-mw-disabled"))return null;n.mwClose()}}),1),!1},r=function(){return l++,new Promise((function(n,t){1!==o?(o=1,clientPackages.get("lightbox").then((function(t){i=t.make({showCloseButton:!1,onBeforeEscKeyClose:d}),n()}))):n()}))},u=function(){return 0!==--l?new Promise((function(n,t){n()})):1===o?(o=2,i.open("",{showCloseButton:!1,spacing:0,onBeforeEscKeyClose:d})):new Promise((function(n,t){n()}))},s=function(){null!==i&&(o=null,i.close(),i=null)},c=function(){var i=null,o=function(){if(null!==i){var n=i.previousSibling;i.setAttribute("class","ipmdlwndwh"),window.setTimeout((function(){e.removeChild(i),0===e.childNodes.length&&(e.parentNode.removeChild(e),e=null),null!==n&&n.setAttribute("class","ipmdlwndwv")}),300),1===e.childNodes.length&&s()}},l=function(){null!==i&&i.removeAttribute("data-mw-disabled")},d=function(){null!==i&&i.setAttribute("data-mw-disabled","1")};return{open:function(s,c,v){void 0===c&&(c={}),void 0===v&&(v={});var f=void 0!==v.onOpen?v.onOpen:null;if(null!==e)for(var h=e.childNodes,m=0;m<h.length;m++)h[m].setAttribute("class","ipmdlwndwvh");var w=function(){if(a(),null!==e){var n=e.lastChild;null!==n&&n.setAttribute("class","ipmdlwndwv")}},p=s+"$"+JSON.stringify(c),b=function(n,r){null===e&&((e=document.createElement("div")).setAttribute("class","ipmdlwndwsc"),document.body.appendChild(e)),(i=document.createElement("div")).setAttribute("data-form-tooltip-container","true"),e.appendChild(i),html5DOMDocument.insert("<div><div><div></div><div></div><div></div></div></div>",[i]);var u=i.firstChild.firstChild;u.firstChild.addEventListener("click",o),u.firstChild.addEventListener("keydown",(function(n){13===n.keyCode&&o()})),u.firstChild.setAttribute("tabindex","0"),void 0!==n.width&&(u.style.width=n.width),void 0!==n.title&&(u.childNodes[1].innerText=n.title),void 0!==n.content&&html5DOMDocument.insert(n.content,[u.lastChild]);for(var s=u.querySelectorAll("form"),c=0;c<s.length;c++){var a=s[c];a.addEventListener("submitstart",d),a.addEventListener("submitend",l)}window.setTimeout((function(){i.setAttribute("class","ipmdlwndwv")}),16),null!==f&&f(i),i.mwClose=o,r&&void 0!==n.cacheTTL&&(t[p]=[n,(new Date).getTime()+1e3*n.cacheTTL])};r().then((function(){void 0!==t[p]&&t[p][1]>(new Date).getTime()?u().then((function(){b(t[p][0],!1)})):clientPackages.get("serverRequests").then((function(t){clientPackages.get("html5DOMDocument").then((function(e){t.send("-modal-window-open",{i:s,d:JSON.stringify(c),g:n?0:1}).then((function(t){var i=JSON.parse(t);void 0!==i.s&&(e.insert(i.s),n=!0),void 0!==i.c?u().then((function(){b(i.c,!0)})):w()})).catch(w)})).catch(w)})).catch(w)}))},close:o,enable:l,disable:d}},a=function(){u(),null!==e&&0!==e.childNodes.length||s()};return{open:function(n,t,e){void 0===e&&(e={});var i=c();return i.open(n,t,e),i},closeAll:function(){if(null!==e){for(var n=e.childNodes,t=n.length-2;t>=0;t--)e.removeChild(n[t]);var i=e.firstChild;null!==i&&i.mwClose()}},closeCurrent:function(){if(null!==e){var n=e.lastChild;null!==n&&n.mwClose()}},showLoading:function(){r()},hideLoading:a,hasOpened:function(){return null!==i}}}();
EOT;
