<?php

/*
 * Modal windows addon for Bear Framework
 * https://github.com/ivopetkov/modal-windows-bearframework-addon
 * Copyright (c) Ivo Petkov
 * Free to use under the MIT license.
 */

return <<<'EOT'
var ivoPetkov=ivoPetkov||{};ivoPetkov.bearFrameworkAddons=ivoPetkov.bearFrameworkAddons||{},ivoPetkov.bearFrameworkAddons.modalWindows=ivoPetkov.bearFrameworkAddons.modalWindows||function(){var t=!1,n=null;Promise=window.Promise||function(t){var n=[],e=null;this.then=function(t){return n.push(t),this},this.catch=function(t){return null===e&&(e=t),this};var i=function(){for(var t in n)n[t].apply(null,arguments)},l=function(){null!==e&&e.apply(null,arguments)};window.setTimeout((function(){t(i,l)}),16)};var e=null,i=null,l=0,o=function(){return setTimeout((function(){if(null!==n&&n.lastChild){var t=n.lastChild;if(null!==t.getAttribute("data-mw-disabled"))return null;t.mwClose()}}),1),!1},d=function(){return 0!==--l?new Promise((function(t,n){t()})):1===i?(i=2,e.open("",{showCloseButton:!1,spacing:0,onBeforeEscKeyClose:o})):new Promise((function(t,n){t()}))},r=function(){null!==e&&(i=null,e.close(),e=null)},s=function(){var e=null,i=function(){if(null!==e){var t=e.previousSibling;e.setAttribute("class","ipmdlwndwh"),window.setTimeout((function(){n.removeChild(e),0===n.childNodes.length&&(n.parentNode.removeChild(n),n=null),null!==t&&t.setAttribute("class","ipmdlwndwv")}),300),1===n.childNodes.length&&r()}},l=function(){null!==e&&e.removeAttribute("data-mw-disabled")},o=function(){null!==e&&e.setAttribute("data-mw-disabled","1")};return{open:function(r,s){if(void 0===s&&(s={}),null!==n)for(var a=n.childNodes,v=0;v<a.length;v++)a[v].setAttribute("class","ipmdlwndwvh");var f=function(){if(c(),null!==n){var t=n.lastChild;null!==t&&t.setAttribute("class","ipmdlwndwv")}};u(),clientPackages.get("serverRequests").then((function(u){clientPackages.get("html5DOMDocument").then((function(c){u.send("-modal-window-open",{i:r,d:JSON.stringify(s),g:t?0:1}).then((function(r){var s=JSON.parse(r);void 0!==s.s&&(c.insert(s.s),t=!0),void 0!==s.c?d().then((function(){null===n&&((n=document.createElement("div")).setAttribute("class","ipmdlwndwsc"),document.body.appendChild(n)),(e=document.createElement("div")).setAttribute("data-form-tooltip-container","true"),n.appendChild(e),c.insert("<div><div><div></div><div></div><div></div></div></div>",[e]);var t=e.firstChild.firstChild;t.firstChild.addEventListener("click",i),t.firstChild.addEventListener("keydown",(function(t){13===t.keyCode&&i()})),t.firstChild.setAttribute("tabindex","0"),void 0!==s.c.width&&(t.style.width=s.c.width),void 0!==s.c.title&&(t.childNodes[1].innerText=s.c.title),void 0!==s.c.content&&c.insert(s.c.content,[t.lastChild]);for(var d=t.querySelectorAll("form"),r=0;r<d.length;r++){var u=d[r];u.addEventListener("submitstart",o),u.addEventListener("submitend",l)}window.setTimeout((function(){e.setAttribute("class","ipmdlwndwv")}),16),e.mwClose=i})):f()})).catch(f)})).catch(f)})).catch(f)},close:i,enable:l,disable:o}},u=function(){l++,1!==i&&(i=1,clientPackages.get("lightbox").then((function(t){e=t.make({showCloseButton:!1,onBeforeEscKeyClose:o})})))},c=function(){d(),null!==n&&0!==n.childNodes.length||r()};return{open:function(t,n){var e=s();return e.open(t,n),e},closeAll:function(){if(null!==n){for(var t=n.childNodes,e=t.length-2;e>=0;e--)n.removeChild(t[e]);var i=n.firstChild;null!==i&&i.mwClose()}},closeCurrent:function(){if(null!==n){var t=n.lastChild;null!==t&&t.mwClose()}},showLoading:u,hideLoading:c}}();
EOT;
