<?php

/*
 * Modal windows addon for Bear Framework
 * https://github.com/ivopetkov/modal-windows-bearframework-addon
 * Copyright (c) Ivo Petkov
 * Free to use under the MIT license.
 */

return <<<'EOT'
var ivoPetkov=ivoPetkov||{};ivoPetkov.bearFrameworkAddons=ivoPetkov.bearFrameworkAddons||{},ivoPetkov.bearFrameworkAddons.modalWindows=ivoPetkov.bearFrameworkAddons.modalWindows||function(){var n=!1,t={},e=null;Promise=window.Promise||function(n){var t=[],e=null;this.then=function(n){return t.push(n),this},this.catch=function(n){return null===e&&(e=n),this};var o=function(){for(var n in t)t[n].apply(null,arguments)},i=function(){null!==e&&e.apply(null,arguments)};window.setTimeout((function(){n(o,i)}),16)};var o=null,i=null,l=0,d=function(){return setTimeout((function(){if(null!==e&&e.lastChild){var n=e.lastChild;if(null!==n.getAttribute("data-mw-disabled"))return null;n.mwClose()}}),1),!1},a=function(){return l++,new Promise((function(n,t){1!==i?(i=1,clientPackages.get("lightbox").then((function(t){o=t.make({showCloseButton:!1,onBeforeEscKeyClose:d}),n()}))):n()}))},r=function(){return 0!==--l?new Promise((function(n,t){n()})):1===i?(i=2,o.open("",{showCloseButton:!1,spacing:0,onBeforeEscKeyClose:d})):new Promise((function(n,t){n()}))},u=function(){null!==o&&(i=null,o.close(),o=null)},c=function(){var o=null,i=function(){if(null!==o){var n=o.previousSibling;o.setAttribute("class","ipmdlwndwh"),window.setTimeout((function(){e.removeChild(o),0===e.childNodes.length&&(e.parentNode.removeChild(e),e=null),null!==n&&n.setAttribute("class","ipmdlwndwv")}),300),1===e.childNodes.length&&u()}},l=function(){null!==o&&o.removeAttribute("data-mw-disabled")},d=function(){null!==o&&o.setAttribute("data-mw-disabled","1")};return{open:function(u,c,v){void 0===c&&(c={}),void 0===v&&(v={});var m=void 0!==v.onOpen?v.onOpen:null;if(null!==e)for(var w=e.childNodes,h=0;h<w.length;h++)w[h].setAttribute("class","ipmdlwndwvh");var f=function(){if(s(),null!==e){var n=e.lastChild;null!==n&&n.setAttribute("class","ipmdlwndwv")}},p=u+"$"+JSON.stringify(c),b=function(n,a){null===e&&((e=document.createElement("div")).setAttribute("class","ipmdlwndwsc"),document.body.appendChild(e)),(o=document.createElement("div")).setAttribute("data-form-tooltip-container","true"),e.appendChild(o);html5DOMDocument.insert('<div><div data-modal-window-component="window"><div data-modal-window-component="header"><div data-modal-window-component="header-title"></div><div data-modal-window-component="header-buttons"><div data-modal-window-component="header-button-close"></div></div></div><div data-modal-window-component="content"></div></div></div>',[o]);var r=o.firstChild.firstChild,u=r.querySelector('[data-modal-window-component="header-title"]'),c=r.querySelector('[data-modal-window-component="header-button-close"]'),s=r.querySelector('[data-modal-window-component="content"]');c.addEventListener("click",i),c.addEventListener("keydown",(function(n){13===n.keyCode&&i()})),c.setAttribute("tabindex","0"),void 0!==n.width&&(r.style.width=n.width),void 0!==n.title&&(u.innerText=n.title),void 0!==n.content&&html5DOMDocument.insert(n.content,[s]);for(var v=r.querySelectorAll("form"),w=0;w<v.length;w++){var h=v[w];h.addEventListener("submitstart",d),h.addEventListener("submitend",l)}window.setTimeout((function(){o.setAttribute("class","ipmdlwndwv")}),16),null!==m&&m(o),o.mwClose=i,a&&void 0!==n.cacheTTL&&(t[p]=[n,(new Date).getTime()+1e3*n.cacheTTL])};a().then((function(){void 0!==t[p]&&t[p][1]>(new Date).getTime()?r().then((function(){b(t[p][0],!1)})):clientPackages.get("serverRequests").then((function(t){clientPackages.get("html5DOMDocument").then((function(e){t.send("-modal-window-open",{i:u,d:JSON.stringify(c),g:n?0:1}).then((function(t){var o=JSON.parse(t);void 0!==o.s&&(e.insert(o.s),n=!0),void 0!==o.c?r().then((function(){b(o.c,!0)})):f()})).catch(f)})).catch(f)})).catch(f)}))},close:i,enable:l,disable:d}},s=function(){r(),null!==e&&0!==e.childNodes.length||u()};return{open:function(n,t,e){void 0===e&&(e={});var o=c();return o.open(n,t,e),o},closeAll:function(){if(null!==e){for(var n=e.childNodes,t=n.length-2;t>=0;t--)e.removeChild(n[t]);var o=e.firstChild;null!==o&&o.mwClose()}},closeCurrent:function(){if(null!==e){var n=e.lastChild;null!==n&&n.mwClose()}},showLoading:function(){a()},hideLoading:s,hasOpened:function(){return null!==o}}}();
EOT;
