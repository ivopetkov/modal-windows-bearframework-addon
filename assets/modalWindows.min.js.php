<?php

/*
 * Modal windows addon for Bear Framework
 * https://github.com/ivopetkov/modal-windows-bearframework-addon
 * Copyright (c) Ivo Petkov
 * Free to use under the MIT license.
 */

return <<<'EOT'
var ivoPetkov=ivoPetkov||{};ivoPetkov.bearFrameworkAddons=ivoPetkov.bearFrameworkAddons||{},ivoPetkov.bearFrameworkAddons.modalWindows=ivoPetkov.bearFrameworkAddons.modalWindows||function(){var n=!1,e={},t=null;Promise=window.Promise||function(n){var e=[],t=null;this.then=function(n){return e.push(n),this},this.catch=function(n){return null===t&&(t=n),this};var o=function(){for(var n in e)e[n].apply(null,arguments)},i=function(){null!==t&&t.apply(null,arguments)};window.setTimeout((function(){n(o,i)}),16)};var o=null,i=null,l=0,d=function(){if(null!==t&&t.lastChild){var n=t.lastChild;if(1===i)return a++,c(n.mwCloseOnEscKey).then((function(){n.setAttribute("class","ipmdlwndwv")})),!1;if(null!==n.getAttribute("data-mw-disabled"))return!1;if(n.mwClose())return!1}else null!==i&&v()},r=function(n){return l++,new Promise((function(e,t){1!==i?(i=1,clientPackages.get("lightbox").then((function(t){o=t.make({showCloseButton:!1,spacing:0,closeOnEscKey:n,onBeforeEscKeyClose:d}),e()}))):e()}))},c=function(n){return--l<0&&(l=0),l>0?new Promise((function(n,e){n()})):1===i?(i=2,o.open("",{showCloseButton:!1,spacing:0,closeOnEscKey:n,onBeforeEscKeyClose:d,resolveBeforeHTMLAdded:!0})):new Promise((function(n,e){n()}))},s=function(){null!==o&&(l=0,i=null,o.close(),o=null)},a=0,u=function(){var o=null,l=function(){if(a++,null!==o){var n=o.previousSibling;return o.setAttribute("class","ipmdlwndwh"),window.setTimeout((function(){t.removeChild(o),0===t.childNodes.length&&(t.parentNode.removeChild(t),t=null),null!==n&&n.setAttribute("class","ipmdlwndwv")}),300),0===t.childNodes.length-1&&s(),!0}return!1},d=function(){null!==o&&o.removeAttribute("data-mw-disabled")},u=function(){null!==o&&o.setAttribute("data-mw-disabled","1")};return{open:function(s,v,w){void 0===v&&(v={}),void 0===w&&(w={});var h=++a,f=void 0!==w.onOpen?w.onOpen:null,p=void 0===w.closeOnEscKey||w.closeOnEscKey;if(null!==t)for(var b=t.childNodes,C=0;C<b.length;C++)b[C].setAttribute("class","ipmdlwndwvh");var g=function(){if(m(),null!==t){var n=t.lastChild;null!==n&&n.setAttribute("class","ipmdlwndwv")}},y=s+"$"+JSON.stringify(v),A=function(n,i){null===t&&((t=document.createElement("div")).setAttribute("class","ipmdlwndwsc"),document.body.appendChild(t)),(o=document.createElement("div")).setAttribute("data-form-tooltip-container","true"),t.appendChild(o);html5DOMDocument.insert('<div><div data-modal-window-component="window"><div data-modal-window-component="header"><div data-modal-window-component="header-title"></div><div data-modal-window-component="header-buttons"><div data-modal-window-component="header-button-close"></div></div></div><div data-modal-window-component="content"></div></div></div>',[o]);var r=o.firstChild.firstChild,c=r.querySelector('[data-modal-window-component="header-title"]'),s=r.querySelector('[data-modal-window-component="header-button-close"]'),a=r.querySelector('[data-modal-window-component="content"]');s.addEventListener("click",l),s.addEventListener("keydown",(function(n){13===n.keyCode&&l()})),s.setAttribute("tabindex","0"),void 0!==n.width&&(r.style.width=n.width),void 0!==n.title&&(c.innerText=n.title),void 0!==n.content&&html5DOMDocument.insert(n.content,[a]);for(var v=r.querySelectorAll("form"),m=0;m<v.length;m++){var w=v[m];w.addEventListener("submitstart",u),w.addEventListener("submitend",d)}window.setTimeout((function(){o.setAttribute("class","ipmdlwndwv")}),16),null!==f&&f(o),o.mwClose=l,o.mwCloseOnEscKey=p,i&&void 0!==n.cacheTTL&&(e[y]=[n,(new Date).getTime()+1e3*n.cacheTTL])};r(p).then((function(){void 0!==e[y]&&e[y][1]>(new Date).getTime()?c(p).then((function(){a===h&&2===i&&A(e[y][0],!1)})):clientPackages.get("serverRequests").then((function(e){clientPackages.get("html5DOMDocument").then((function(t){e.send("-modal-window-open",{i:s,d:JSON.stringify(v),g:n?0:1}).then((function(e){c(p).then((function(){if(a===h&&2===i){var o=JSON.parse(e);void 0!==o.s&&(t.insert(o.s),n=!0),void 0!==o.c?A(o.c,!0):g()}}))})).catch(g)})).catch(g)})).catch(g)}))},close:l,enable:d,disable:u}},v=function(){return new Promise((function(n,e){if(null!==t&&t.childNodes.length>0){for(var o=t.childNodes,i=o.length-2;i>=0;i--)t.removeChild(o[i]);var l=t.firstChild;null!==l&&l.mwClose(),n()}else a++,m().then(n).catch(e)}))},m=function(){return new Promise((function(n,e){var o=!0;null!==t&&t.lastChild&&(o=t.lastChild.mwCloseOnEscKey);c(o).then((function(){null!==t&&0!==t.childNodes.length||s(),n()})).catch(e)}))};return{open:function(n,e,t){void 0===t&&(t={});var o=u();return o.open(n,e,t),o},closeAll:v,closeCurrent:function(){if(null!==t){var n=t.lastChild;null!==n&&n.mwClose()}},showLoading:function(n){void 0===n&&(n={});var e=void 0===n.closeOnEscKey||n.closeOnEscKey;return new Promise((function(n,t){r(e).then(n).catch(t)}))},hideLoading:m,hasOpened:function(){return null!==o}}}();
EOT;
