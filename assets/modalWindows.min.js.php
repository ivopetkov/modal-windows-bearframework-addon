<?php

/*
 * Modal windows addon for Bear Framework
 * https://github.com/ivopetkov/modal-windows-bearframework-addon
 * Copyright (c) Ivo Petkov
 * Free to use under the MIT license.
 */

return <<<'EOT'
var ivoPetkov=ivoPetkov||{};ivoPetkov.bearFrameworkAddons=ivoPetkov.bearFrameworkAddons||{},ivoPetkov.bearFrameworkAddons.modalWindows=ivoPetkov.bearFrameworkAddons.modalWindows||function(){Promise=window.Promise||function(t){var e=[],n=null;this.then=function(t){return e.push(t),this},this.catch=function(t){return null===n&&(n=t),this};var i=function(){for(var t in e)e[t].apply(null,arguments)},o=function(){null!==n&&n.apply(null,arguments)};window.setTimeout((function(){t(i,o)}),16)};var t=null,e=null,n=0,i=function(){return 0!==--n?new Promise((function(t,e){t()})):1===e?(e=2,t.open("",{showCloseButton:!1,spacing:0})):new Promise((function(t,e){t()}))},o=function(){null!==t&&(e=null,t.close(),t=null)},l=!1,d=null,r=!1,s=null,u=null,c=function(){if(null!==u)return u;var t=document.createElement("p");t.style.width="100%",t.style.height="200px";var e=document.createElement("div");e.style.position="absolute",e.style.top="-10000px",e.style.left="-10000px",e.style.visibility="hidden",e.style.width="200px",e.style.height="150px",e.style.overflow="hidden",e.appendChild(t),document.body.appendChild(e);var n=t.offsetWidth;e.style.overflow="scroll";var i=t.offsetWidth;return n===i&&(i=e.clientWidth),document.body.removeChild(e),u=n-i},a=function(){var t=null,e=function(){if(null!==t){var e=t.previousSibling;t.setAttribute("class","ipmdlwndwh"),window.setTimeout((function(){d.removeChild(t),0===d.childNodes.length&&(d.parentNode.removeChild(d),d=null),null!==e&&e.setAttribute("class","ipmdlwndwv")}),300),1===d.childNodes.length&&o()}},n=function(){null!==t&&t.removeAttribute("data-mw-disabled")},u=function(){null!==t&&t.setAttribute("data-mw-disabled","1")};return{open:function(o,a){if(void 0===a&&(a={}),null!==d)for(var m=d.childNodes,f=0;f<m.length;f++)m[f].setAttribute("class","ipmdlwndwvh");var w=function(){if(h(),null!==d){var t=d.lastChild;null!==t&&t.setAttribute("class","ipmdlwndwv")}};v(),clientPackages.get("serverRequests").then((function(v){clientPackages.get("-ivopetkov-js-modal-windows-html5domdocument").then((function(h){v.send("-modal-window-open",{i:o,d:JSON.stringify(a),g:l?0:1}).then((function(o){var a=JSON.parse(o);void 0!==a.s&&(h.insert(a.s),l=!0),void 0!==a.c?i().then((function(){null===d&&((d=document.createElement("div")).setAttribute("class","ipmdlwndwsc"),document.body.appendChild(d),r||(document.body.style.overflow="hidden",document.body.scrollHeight>window.innerHeight&&(document.body.style.marginRight=c()+"px"),s=window.setInterval((function(){null===d&&(window.clearInterval(s),document.body.style.overflow="auto",document.body.style.marginRight="auto",r=!1)}),16),r=!0)),(t=document.createElement("div")).setAttribute("data-form-tooltip-container","true"),d.appendChild(t),h.insert("<div><div><div></div><div></div><div></div></div></div>",[t]);var i=t.firstChild.firstChild;i.firstChild.addEventListener("click",e),void 0!==a.c.width&&(i.style.width=a.c.width),void 0!==a.c.title&&(i.childNodes[1].innerText=a.c.title),void 0!==a.c.content&&h.insert(a.c.content,[i.lastChild]);for(var o=i.querySelectorAll("form"),l=0;l<o.length;l++){var v=o[l];v.addEventListener("submitstart",u),v.addEventListener("submitend",n)}window.setTimeout((function(){t.setAttribute("class","ipmdlwndwv")}),16),t.mwClose=e})):w()})).catch(w)})).catch(w)})).catch(w)},close:e,enable:n,disable:u}},v=function(){n++,1!==e&&(e=1,clientPackages.get("lightbox").then((function(e){t=e.make({showCloseButton:!1})})))},h=function(){i(),null!==d&&0!==d.childNodes.length||o()};return{open:function(t,e){var n=a();return n.open(t,e),n},closeAll:function(){if(null!==d){for(var t=d.childNodes,e=t.length-2;e>=0;e--)d.removeChild(t[e]);var n=d.firstChild;null!==n&&n.mwClose()}},showLoading:v,hideLoading:h}}();
EOT;
