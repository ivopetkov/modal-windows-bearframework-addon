<?php

/*
 * Modal windows addon for Bear Framework
 * https://github.com/ivopetkov/modal-windows-bearframework-addon
 * Copyright (c) Ivo Petkov
 * Free to use under the MIT license.
 */

return <<<'EOT'
var ivoPetkov=ivoPetkov||{};ivoPetkov.bearFrameworkAddons=ivoPetkov.bearFrameworkAddons||{},ivoPetkov.bearFrameworkAddons.modalWindows=ivoPetkov.bearFrameworkAddons.modalWindows||function(){Promise=window.Promise||function(t){var n=[],e=null;this.then=function(t){return n.push(t),this},this.catch=function(t){return null===e&&(e=t),this};var i=function(){for(var t in n)n[t].apply(null,arguments)},o=function(){null!==e&&e.apply(null,arguments)};window.setTimeout((function(){t(i,o)}),16)};var t=null,n=null,e=0,i=function(){return 0!==--e?new Promise((function(t,n){t()})):1===n?(n=2,t.open("",{showCloseButton:!1,spacing:0})):new Promise((function(t,n){t()}))},o=function(){null!==t&&(n=null,t.close(),t=null)},l=!1,d=null,s=function(){var t=null,n=function(){if(null!==t){var n=t.previousSibling;t.setAttribute("class","ipmdlwndwh"),window.setTimeout((function(){d.removeChild(t),0===d.childNodes.length&&(d.parentNode.removeChild(d),d=null),null!==n&&n.setAttribute("class","ipmdlwndwv")}),300),1===d.childNodes.length&&o()}},e=function(){null!==t&&t.removeAttribute("data-mw-disabled")},s=function(){null!==t&&t.setAttribute("data-mw-disabled","1")};return{open:function(o,c){if(void 0===c&&(c={}),null!==d)for(var a=d.childNodes,v=0;v<a.length;v++)a[v].setAttribute("class","ipmdlwndwvh");var h=function(){if(u(),null!==d){var t=d.lastChild;null!==t&&t.setAttribute("class","ipmdlwndwv")}};r(),clientPackages.get("serverRequests").then((function(r){clientPackages.get("html5DOMDocument").then((function(u){r.send("-modal-window-open",{i:o,d:JSON.stringify(c),g:l?0:1}).then((function(o){var r=JSON.parse(o);void 0!==r.s&&(u.insert(r.s),l=!0),void 0!==r.c?i().then((function(){null===d&&((d=document.createElement("div")).setAttribute("class","ipmdlwndwsc"),document.body.appendChild(d)),(t=document.createElement("div")).setAttribute("data-form-tooltip-container","true"),d.appendChild(t),u.insert("<div><div><div></div><div></div><div></div></div></div>",[t]);var i=t.firstChild.firstChild;i.firstChild.addEventListener("click",n),i.firstChild.addEventListener("keydown",(function(t){13===t.keyCode&&n()})),i.firstChild.setAttribute("tabindex","0"),void 0!==r.c.width&&(i.style.width=r.c.width),void 0!==r.c.title&&(i.childNodes[1].innerText=r.c.title),void 0!==r.c.content&&u.insert(r.c.content,[i.lastChild]);for(var o=i.querySelectorAll("form"),l=0;l<o.length;l++){var c=o[l];c.addEventListener("submitstart",s),c.addEventListener("submitend",e)}window.setTimeout((function(){t.setAttribute("class","ipmdlwndwv")}),16),t.mwClose=n})):h()})).catch(h)})).catch(h)})).catch(h)},close:n,enable:e,disable:s}},r=function(){e++,1!==n&&(n=1,clientPackages.get("lightbox").then((function(n){t=n.make({showCloseButton:!1})})))},u=function(){i(),null!==d&&0!==d.childNodes.length||o()};return{open:function(t,n){var e=s();return e.open(t,n),e},closeAll:function(){if(null!==d){for(var t=d.childNodes,n=t.length-2;n>=0;n--)d.removeChild(t[n]);var e=d.firstChild;null!==e&&e.mwClose()}},showLoading:r,hideLoading:u}}();
EOT;
